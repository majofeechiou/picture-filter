!function(t){function e(i){if(n[i])return n[i].exports;var a=n[i]={exports:{},id:i,loaded:!1};return t[i].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(6)},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){n(this,t)}return i(t,null,[{key:"getConstNameByEn",value:function(e){return"string"==typeof e&&""!==e?t["METHOD_"+e+"_NAME"]:void 0}},{key:"getInitOutputImageScale",value:function(){return{size:this.OUTPUT_SIZE_SCALE,range:100}}},{key:"getInitOutputImageCustom",value:function(){return{size:this.OUTPUT_SIZE_CUSTOM,width:200,height:200,custom:this.OUTPUT_CUSTOM_COVER}}}]),t}();a.METHOD_SNOW="SNOW",a.METHOD_SNOW_NAME="雪花",a.METHOD_DOT="DOT",a.METHOD_DOT_NAME="黑點",a.METHOD_ALPHA="ALPHA",a.METHOD_ALPHA_NAME="透明",a.METHOD_GRAY="GRAY",a.METHOD_GRAY_NAME="灰階",a.METHOD_BRIGHTNESS="BRIGHTNESS",a.METHOD_BRIGHTNESS_NAME="亮度",a.METHOD_CONTRAST="CONTRAST",a.METHOD_CONTRAST_NAME="對比",a.METHOD_SATURATE="SATURATE",a.METHOD_SATURATE_NAME="彩度",a.METHOD_HUE_ROTATE="HUE_ROTATE",a.METHOD_HUE_ROTATE_NAME="色相轉換",a.METHOD_INVERT="INVERT",a.METHOD_INVERT_NAME="負片",a.METHOD_SEPIA="SEPIA",a.METHOD_SEPIA_NAME="復古",a.OUTPUT_SIZE_SCALE="scale",a.OUTPUT_SIZE_CUSTOM="custom",a.OUTPUT_CUSTOM_COVER="cover",a.OUTPUT_CUSTOM_CONTAIN="contain",a.OUTPUT_CUSTOM_FILL="fill",a.OUTPUT_CUSTOM_CLIP="clip",e.default=a},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){n(this,t)}return i(t,[{key:"getEmitter",value:function(){return this.emitter}},{key:"setEmitter",value:function(t){this.emitter=t}}]),t}();e.default=a},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function a(){n(this,a)};i.createNowId=function(){return Date.now()},i.createUniqueId=function(){return Math.floor(1e3*Math.random())},i.createMethodId=function(){return Date.now()+"-"+Math.floor(100*Math.random())},e.default=i},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function a(){n(this,a),this.WEAK_MAP=new WeakMap,this.initGlobalConst=function(t){var e={};return this.WEAK_MAP.set(t,e),e},this.getGlobalConst=function(t){return this.WEAK_MAP.get(t)},this.addGlobalConst=function(t,e,n){var i=this.WEAK_MAP||{};return i[e]=n,this.WEAK_MAP.set(t,i),i}};e.default=i},function(t,e){"use strict";function n(t){return t?i(t):void 0}function i(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},n.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i,a=0;a<n.length;a++)if(i=n[a],i===e||i.fn===e){n.splice(a,1);break}return this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks["$"+t];if(n){n=n.slice(0);for(var i=0,a=n.length;a>i;++i)n[i].apply(this,e)}return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,n){"use strict";n(7)},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}var a=n(11),o=i(a);!function(){var t=document.querySelectorAll('[data-majo="picture-filter"]');new o.default(t[0],{});new o.default(t[1],{width:250,height:100}),new o.default(t[2],{width:250,height:100})}()},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Object.defineProperty(e,"__esModule",{value:!0});var s=n(2),l=i(s),d=function(t){function e(t){a(this,e);var n=o(this,Object.getPrototypeOf(e).call(this)),i=n;return i.setEmitter(t.emitter),i.obj_canvas=document.createElement("canvas"),i.obj_canvas_2d=i.obj_canvas.getContext("2d"),i.obj_image=new Image,i.obj_image.onload=function(){if("string"==typeof this.src&&""!==this.src){var t=this.width,e=this.height;i.obj_canvas.width=t,i.obj_canvas.height=e,i.obj_canvas_2d.drawImage(this,0,0,t,e),i.setComputeWidth(t),i.setComputeHeight(e),i.getEmitter().emit("origin.image.info.loaded",{width:t,height:e}),i.getEmitter().emit("step.image.success.loaded",{origin_data:this.src,method:i.getPainterMethod()})}else console.log("***")},i.obj_image.error=function(){i.getEmitter().emit("step.image.error.loaded",{origin_data:this.src})},n}return r(e,t),u(e,[{key:"getPainterMethod",value:function(){var t=this;return t.painter_method}},{key:"getComputeWidth",value:function(){return this.compute_width}},{key:"getComputeHeight",value:function(){return this.compute_height}},{key:"setComputeWidth",value:function(t){this.compute_width=t||0}},{key:"setComputeHeight",value:function(t){this.compute_height=t||0}},{key:"changeData",value:function(t,e){var n=this;n.painter_method=t,n.obj_image.src=e}},{key:"methodOrigin",value:function(t){var e=this;e.emitAfterMethod(t)}},{key:"methodSnow",value:function(t){for(var e=this,n=e.getComputeWidth(),i=e.getComputeHeight(),a=void 0,o=void 0,r=0;500>=r;r++)a=Math.floor(Math.random()*n),o=Math.floor(Math.random()*i),e.obj_canvas_2d.fillStyle="white",e.obj_canvas_2d.beginPath(),e.obj_canvas_2d.arc(a,o,3,0,2*Math.PI,!0),e.obj_canvas_2d.closePath(),e.obj_canvas_2d.fill();e.emitAfterMethod(t)}},{key:"methodDot",value:function(t){for(var e=this,n=e.getComputeWidth(),i=e.getComputeHeight(),a=void 0,o=void 0,r=0;150>=r;r++)a=Math.floor(Math.random()*n),o=Math.floor(Math.random()*i),e.obj_canvas_2d.fillStyle="black",e.obj_canvas_2d.beginPath(),e.obj_canvas_2d.arc(a,o,5,0,2*Math.PI,!0),e.obj_canvas_2d.closePath(),e.obj_canvas_2d.fill();e.emitAfterMethod(t)}},{key:"methodAlpha",value:function(t){for(var e=this,n=e.getComputeWidth(),i=e.getComputeHeight(),a=e.obj_canvas_2d.getImageData(0,0,n,i),o=0;n*i*4>o;o+=4)a.data[o+3]=.5*a.data[o+3];e.obj_canvas_2d.putImageData(a,0,0),e.emitAfterMethod(t)}},{key:"methodGray",value:function(t){for(var e=this,n=e.getComputeWidth(),i=e.getComputeHeight(),a=e.obj_canvas_2d.getImageData(0,0,n,i),o=void 0,r=void 0,u=void 0,s=void 0,l=0;n*i*4>l;l+=4)o=a.data[l],r=a.data[l+1],u=a.data[l+2],s=parseInt((o+r+u)/3),a.data[l]=s,a.data[l+1]=s,a.data[l+2]=s;e.obj_canvas_2d.putImageData(a,0,0),e.emitAfterMethod(t)}},{key:"methodContrast",value:function(t){for(var e=this,n=e.getComputeWidth(),i=e.getComputeHeight(),a=e.obj_canvas_2d.getImageData(0,0,n,i),o=-50,r=259*(o+255)/(255*(259-o)),u=0;u<a.data.length;u+=4)a.data[u]=r*(a.data[u]-128)+128,a.data[u+1]=r*(a.data[u+1]-128)+128,a.data[u+2]=r*(a.data[u+2]-128)+128;e.obj_canvas_2d.putImageData(a,0,0),e.emitAfterMethod(t)}},{key:"emitAfterMethod",value:function(t){t=t||{};var e=this,n=e.obj_canvas.toDataURL(),i={origin_data:t.origin_data,data:n};void 0!==t.method_id&&(i.method_id=t.method_id),e.getEmitter().emit("step.image.success.computed",i)}}]),e}(l.default);e.default=d},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Object.defineProperty(e,"__esModule",{value:!0});var s=n(2),l=i(s),d=function(t){function e(t){a(this,e);var n=o(this,Object.getPrototypeOf(e).call(this));return n.step_image=[],n.setEmitter(t.emitter),n}return r(e,t),u(e,[{key:"getStepImage",value:function(){return this.step_image||[]}},{key:"setStepImage",value:function(t,e,n){var i=this;t=t||[],e=e||i.TIMMING_SET,n=n||{};var a=JSON.parse(JSON.stringify(t));this.step_image=a,i.getEmitter().emit("step.image.seted",e,n)}},{key:"pushStepData",value:function(t,e){var n=this;if(void 0===t.method_id){var i=JSON.parse(JSON.stringify(n.getStepImage())),a=i.length,o=JSON.parse(JSON.stringify(e)),r=o.length;if(r>=a){var u=o[a].method_id;t.method_id=u}}n.step_image.push(t),console.log("_scope.step_image :: ",n.step_image),n.getEmitter().emit("step.image.pushed")}}]),e}(l.default);d.TIMMING_RESET="reset",d.TIMMING_SET="set",e.default=d},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Object.defineProperty(e,"__esModule",{value:!0});var s=n(3),l=i(s),d=n(1),c=i(d),h=n(4),m=i(h),g=function(t){function e(t,n){a(this,e);var i=o(this,Object.getPrototypeOf(e).call(this));return i.setEmitter(n.emitter),i.setModuleId(l.default.createUniqueId()),i.setOutputImageSetting(i.getInitOutputImageCustom()),i.defaultAction(t),i}return r(e,t),u(e,[{key:"setModuleId",value:function(t){this.module_id=t}},{key:"setImageInitData",value:function(t){this.image_init_data=t,this.getEmitter().emit("init.data.changed",{origin_data:t})}},{key:"setEmitter",value:function(t){this.emitter=t}},{key:"setOutputImageSetting",value:function(t){this.output_image_setting=t||{}}},{key:"getInitOutputImageScale",value:function(){return c.default.getInitOutputImageScale()}},{key:"getInitOutputImageCustom",value:function(){return c.default.getInitOutputImageCustom()}},{key:"getOutputImageSetting",value:function(){return this.output_image_setting||{}}},{key:"getEmitter",value:function(){return this.emitter}},{key:"getModuleId",value:function(){return this.module_id}},{key:"getMainSection",value:function(){return this.getGlobalConst(this).MAIN_SECTION}},{key:"getObjImagePreview",value:function(){return this.getGlobalConst(this).OBJ_IMAGE_PREVIEW}},{key:"getObjMethodSelect",value:function(){return this.getGlobalConst(this).OBJ_METHOD_SELECT}},{key:"getObjMethodResult",value:function(){return this.getGlobalConst(this).OBJ_METHOD_RESULT}},{key:"getObjUpload",value:function(){return this.getGlobalConst(this).OBJ_UPLOAD}},{key:"getObjsSizeSubmit",value:function(){return this.getGlobalConst(this).OBJ_SIZE_SUBMIT}},{key:"getObjsSizeScaleRadio",value:function(){return this.getGlobalConst(this).OBJ_SIZE_SCALE_RADIO}},{key:"getObjsSizeCustomRadio",value:function(){return this.getGlobalConst(this).OBJ_SIZE_CUSTOM_RADIO}},{key:"getObjsSizeRange",value:function(){return this.getGlobalConst(this).OBJ_SCALE_RANGE}},{key:"getObjsSizeCustomWidth",value:function(){return this.getGlobalConst(this).OBJ_SIZE_CUSTOM_WIDTH}},{key:"getObjsSizeCustomHeight",value:function(){return this.getGlobalConst(this).OBJ_SIZE_CUSTOM_HEIGHT}},{key:"returnUploadSection",value:function(){var t=document.createElement("div"),e=document.createElement("input");return e.type="file",this.uploadAction.call(e,this),this.addGlobalConst(this,"OBJ_UPLOAD",e),t.appendChild(e),t}},{key:"returnCanvasSection",value:function(){var t=document.createElement("div"),e=new Image;return e.style.border="1px solid #f00",this.addGlobalConst(this,"OBJ_IMAGE_PREVIEW",e),t.appendChild(e),t}},{key:"returnMethodSection",value:function(){var t=document.createElement("div"),e=document.createElement("span");t.appendChild(e);var n=document.createElement("select");n.name="method";var i="";i+='<option value="">---請選擇---</option>',i+='<option value="'+c.default.METHOD_SNOW+'">'+c.default.METHOD_SNOW_NAME+"</option>",i+='<option value="'+c.default.METHOD_ALPHA+'">'+c.default.METHOD_ALPHA_NAME+"</option>",i+='<option value="'+c.default.METHOD_DOT+'">'+c.default.METHOD_DOT_NAME+"</option>",i+='<option value="'+c.default.METHOD_GRAY+'">'+c.default.METHOD_GRAY_NAME+"</option>",i+='<option value="'+c.default.METHOD_CONTRAST+'">'+c.default.METHOD_CONTRAST_NAME+"</option>",n.insertAdjacentHTML("afterbegin",i);var a=document.createElement("button");return a.innerText="新增效果",this.methodAddBtnAction.call(a,this),t.appendChild(n),t.appendChild(a),this.addGlobalConst(this,"OBJ_METHOD_SECTION",t),this.addGlobalConst(this,"OBJ_METHOD_RESULT",e),this.addGlobalConst(this,"OBJ_METHOD_SELECT",n),t}},{key:"returnSizeSection",value:function(){var t=document.createElement("div");t.innerText="圖片輸出尺寸";var e=document.createElement("div"),n=document.createElement("div"),i=document.createElement("input");i.type="radio",i.name="size_"+this.getModuleId(),i.value="scale",i.checked=this.getOutputImageSetting().size===c.default.OUTPUT_SIZE_SCALE,this.addGlobalConst(this,"OBJ_SIZE_SCALE_RADIO",i);var a=document.createElement("label");a.appendChild(i),a.insertAdjacentHTML("beforeend","原圖等比縮放");var o=document.createElement("input");o.type="range",o.name="range_"+this.getModuleId(),o.value=this.getInitOutputImageScale().range,o.min=1,o.max=200,this.addGlobalConst(this,"OBJ_SCALE_RANGE",o),e.appendChild(a),e.appendChild(o);var r=document.createElement("input");r.type="radio",r.name="size_"+this.getModuleId(),r.value="custom",r.checked=this.getOutputImageSetting().size===c.default.OUTPUT_SIZE_CUSTOM,this.addGlobalConst(this,"OBJ_SIZE_CUSTOM_RADIO",r);var u=document.createElement("label");u.appendChild(r),u.insertAdjacentHTML("beforeend","自訂尺寸");var s=document.createElement("input");s.type="number",s.name="custom_width_"+this.getModuleId(),s.min=10,s.max=3e3,s.value=this.getInitOutputImageCustom().width,this.addGlobalConst(this,"OBJ_SIZE_CUSTOM_WIDTH",s);var l=document.createElement("input");l.type="number",l.name="custom_height_"+this.getModuleId(),l.min=10,l.max=3e3,l.value=this.getInitOutputImageCustom().height,this.addGlobalConst(this,"OBJ_SIZE_CUSTOM_HEIGHT",l);var d=document.createElement("input");d.type="radio",d.name="custom_"+this.getModuleId(),d.value="cover",d.checked=this.getInitOutputImageCustom().custom===c.default.OUTPUT_CUSTOM_COVER,this.addGlobalConst(this,"OBJ_SIZE_CUSTOM_COVER",d);var h=document.createElement("label");h.appendChild(d),h.insertAdjacentHTML("beforeend","COVER");var m=document.createElement("input");m.type="radio",m.name="custom_"+this.getModuleId(),m.value="contain",m.checked=this.getInitOutputImageCustom().custom===c.default.OUTPUT_CUSTOM_CONTAIN,this.addGlobalConst(this,"OBJ_SIZE_CUSTOM_CONTAIN",m);var g=document.createElement("label");g.appendChild(m),g.insertAdjacentHTML("beforeend","CONTAIN");var f=document.createElement("input");f.type="radio",f.name="custom_"+this.getModuleId(),f.value="fill",f.checked=this.getInitOutputImageCustom().custom===c.default.OUTPUT_CUSTOM_FILL,this.addGlobalConst(this,"OBJ_SIZE_CUSTOM_FILL",f);var _=document.createElement("label");_.appendChild(f),_.insertAdjacentHTML("beforeend","FILL");var p=document.createElement("input");p.type="radio",p.name="custom_"+this.getModuleId(),p.value="clip",p.checked=this.getInitOutputImageCustom().custom===c.default.OUTPUT_CUSTOM_CLIP,this.addGlobalConst(this,"OBJ_SIZE_CUSTOM_CLIP",p);var v=document.createElement("label");v.appendChild(p),v.insertAdjacentHTML("beforeend","CLIP"),n.appendChild(u),n.insertAdjacentHTML("beforeend","寬"),n.appendChild(s),n.insertAdjacentHTML("beforeend","高"),n.appendChild(l),n.appendChild(h),n.appendChild(g),n.appendChild(_),n.appendChild(v);var O=document.createElement("button");return O.innerText="確定",this.addGlobalConst(this,"OBJ_SIZE_SUBMIT",O),t.appendChild(e),t.appendChild(n),t.appendChild(O),t}},{key:"makeTempate",value:function(){var t=this,e=this.getMainSection();if(void 0!==e){var n=this.returnUploadSection(),i=this.returnCanvasSection(),a=this.returnSizeSection(),o=this.returnMethodSection();e.appendChild(a),e.appendChild(n),e.appendChild(o),e.appendChild(i),t.judgeOutputImageSetting.call(t.getObjsSizeSubmit(),t)}}},{key:"judgeOutputImageSetting",value:function(t){var e=this;e.onclick=function(e){var n=t.getObjsSizeScaleRadio(),i=t.getObjsSizeCustomRadio(),a=n.checked===!0?n.value:i.checked===!0?i.value:"",o={size:a};a===c.default.OUTPUT_SIZE_SCALE?o.range=t.getObjsSizeRange().value:a===c.default.OUTPUT_SIZE_CUSTOM&&(o.width=t.getObjsSizeCustomWidth().value,o.height=t.getObjsSizeCustomHeight().value,o.custom=document.querySelectorAll('[name="custom_'+t.getModuleId()+'"]:checked')[0].value||""),t.setOutputImageSetting(o)}}},{key:"operateOutputImage",value:function(){var t=this;t.obj_image=document.createElement("img"),t.obj_image.onload=function(){console.log("onload")},t.obj_canvas=document.createElement("canvas"),t.obj_canvas_2d=t.obj_canvas.getContext("2d"),t.getEmitter().on("step.image.final.step.computed",function(e){var n=arguments[0];t.obj_canvas_2d.clearRect(0,0,t.obj_canvas.width,t.obj_canvas.height);var i=t.getOutputImageSetting(),a=i.size;if(t.obj_image.src=n.data,a===c.default.OUTPUT_SIZE_SCALE){var o=Math.floor(n.origin_width*i.range/100),r=Math.floor(n.origin_height*i.range/100);t.obj_canvas.width=o,t.obj_canvas.height=r,t.obj_canvas_2d.drawImage(t.obj_image,0,0,n.origin_width,n.origin_height,0,0,o,r),t.getObjImagePreview().src=t.obj_canvas.toDataURL()}else if(a===c.default.OUTPUT_SIZE_CUSTOM){t.obj_canvas.width=i.width,t.obj_canvas.height=i.height;var u=n.origin_height/n.origin_width,s=i.height/i.width;i.width/n.origin_width*n.origin_height,i.height/n.origin_height*n.origin_width;i.custom===c.default.OUTPUT_CUSTOM_COVER?u>s?t.baseOnWidth(n,i):s>u?t.baseOnHeight(n,i):t.baseOnWidthHeight(n,i):i.custom===c.default.OUTPUT_CUSTOM_CONTAIN?u>s?t.baseOnHeight(n,i):s>u?t.baseOnWidth(n,i):t.baseOnWidthHeight(n,i):i.custom===c.default.OUTPUT_CUSTOM_FILL?t.baseOnWidthHeight(n,i):i.custom===c.default.OUTPUT_CUSTOM_CLIP&&t.baseOnClip(n,i),t.getObjImagePreview().src=t.obj_canvas.toDataURL()}})}},{key:"baseOnWidth",value:function(t,e){var n=this,i=e.width/t.origin_width*t.origin_height;n.obj_canvas_2d.drawImage(n.obj_image,0,0,t.origin_width,t.origin_height,0,e.height/2-i/2,e.width,i)}},{key:"baseOnHeight",value:function(t,e){var n=this,i=e.height/t.origin_height*t.origin_width;n.obj_canvas_2d.drawImage(n.obj_image,0,0,t.origin_width,t.origin_height,e.width/2-i/2,0,i,e.height)}},{key:"baseOnWidthHeight",value:function(t,e){var n=this;n.obj_canvas_2d.drawImage(n.obj_image,0,0,t.origin_width,t.origin_height,0,0,e.width,e.height)}},{key:"baseOnClip",value:function(t,e){var n=this;n.obj_canvas_2d.drawImage(n.obj_image,t.origin_width/2-e.width/2,t.origin_height/2-e.height/2,e.width,e.height,0,0,e.width,e.height)}},{key:"defaultAction",value:function(t){var e=this;e.initGlobalConst(this),t.nodeType>=1&&(e.addGlobalConst(this,"MAIN_SECTION",t),e.makeTempate()),e.operateOutputImage()}},{key:"uploadAction",value:function(t){var e=this;e.onchange=function(e){var n=window.URL||window.webkitURL,i=n.createObjectURL(this.files[0]);t.setImageInitData(i)}}},{key:"methodAddBtnAction",value:function(t){var e=this;e.onclick=function(e){var n=t.getObjMethodSelect().value;""!==n?t.getEmitter().emit("step.method.pushing",{method:n}):console.log("不應為空!!")}}},{key:"methodDeleteBtnAction",value:function(t){var e=this;e.onclick=function(n){t.getEmitter().emit("step.method.splicing",{method:e.data.method,method_id:e.data.method_id,method_btn:this})}}}]),e}(m.default);e.default=g},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),l=i(s),d=n(3),c=(i(d),n(10)),h=i(c),m=n(8),g=i(m),f=n(9),_=i(f),p=n(12),v=i(p),O=n(4),b=i(O),E=n(5),T=i(E),y=function(t){function e(t){a(this,e);var n=o(this,Object.getPrototypeOf(e).call(this)),i=n,r=new T.default;i.addGlobalConst(i,"emitter",r);var u=new h.default(t,{emitter:r}),s=new v.default({emitter:r}),d=new _.default({emitter:r}),c=new g.default({emitter:r});return void 0!==t&&(i.getGlobalConst(i).emitter.on("step.method.show.adding",function(t){var e=arguments[0],n=document.createElement("span");n.style.marginRight="20px",n.data=n.data||{},n.data.method_id=e.method_id,n.data.method=e.method,n.setAttribute("data-method-id",e.method_id),n.insertAdjacentHTML("beforeend",l.default.getConstNameByEn(e.method)),u.getObjMethodResult().appendChild(n),u.methodDeleteBtnAction.call(n,u);var a=d.getStepImage();if(a instanceof Array==!0&&a.length>0){c.getComputeWidth(),c.getComputeHeight();i.getGlobalConst(i).emitter.emit("step.image.success.loaded",{origin_data:a[a.length-1].data,method:e.method})}}),i.getGlobalConst(i).emitter.on("step.method.show.deleting",function(t){var e=arguments[0],n=d.getStepImage();if(n instanceof Array==!0&&n.length>0){for(var i=n.length,a=[],o=0;i>o&&n[o].method_id!==e.method_id;o++)a.push(n[o]);var r=a.length;r<n.length&&d.setStepImage(a)}u.getObjMethodResult().removeChild(e.method_btn)}),i.getGlobalConst(i).emitter.on("step.method.pushing",function(){s.pushStepMethod.apply(s,arguments)}),i.getGlobalConst(i).emitter.on("step.method.splicing",function(){s.spliceStepMethod.apply(s,arguments)}),i.getGlobalConst(i).emitter.on("step.method.option.added",function(t){var e=arguments[0];i.getGlobalConst(i).emitter.emit("step.method.show.adding",e)}),i.getGlobalConst(i).emitter.on("step.method.option.deleted",function(t){var e=arguments[0];i.getGlobalConst(i).emitter.emit("step.method.show.deleting",e)}),i.getGlobalConst(i).emitter.on("init.data.changed",function(t){var e=arguments[0];d.setStepImage([],_.default.TIMMING_RESET,e)}),i.getGlobalConst(i).emitter.on("origin.image.info.loaded",function(t){var e=arguments[0];i.setOriginImageWidth(e.width),i.setOriginImageHeight(e.height)}),i.getGlobalConst(i).emitter.on("step.image.success.loaded",function(t){var e=arguments[0],n=e.method;n===l.default.METHOD_SNOW?c.methodSnow(e):n===l.default.METHOD_DOT?c.methodDot(e):n===l.default.METHOD_ALPHA?c.methodAlpha(e):n===l.default.METHOD_GRAY?c.methodGray(e):n===l.default.METHOD_CONTRAST?c.methodContrast(e):c.methodOrigin(e)}),i.getGlobalConst(i).emitter.on("step.image.error.loaded",function(t){}),i.getGlobalConst(i).emitter.on("step.image.success.computed",function(t){var e=arguments[0];e&&"string"==typeof e.origin_data&&""!==e.origin_data&&d.pushStepData(e,s.getStepMethod())}),i.getGlobalConst(i).emitter.on("step.image.seted",function(t){var e=arguments[0],n=arguments[1]||{};e===_.default.TIMMING_RESET?c.changeData("",n.origin_data):i.getGlobalConst(i).emitter.emit("step.image.pushed")}),i.getGlobalConst(i).emitter.on("step.image.pushed",function(t){var e=(arguments[0],arguments[1]||{},d.getStepImage().length),n=s.getStepMethod(),a=d.getStepImage(),o=a[a.length-1];e<n.length?c.changeData(n[e].method,o.data):(o.origin_width=i.getOriginImageWidth(),o.origin_height=i.getOriginImageHeight(),i.getGlobalConst(i).emitter.emit("step.image.final.step.computed",o),console.log("******************* 預覽圖片!! *******************"))})),n}return r(e,t),u(e,[{key:"setOriginImageWidth",value:function(t){this.origin_image_width=t||0}},{key:"setOriginImageHeight",value:function(t){this.origin_image_height=t||0}},{key:"getOriginImageWidth",value:function(){return this.origin_image_width}},{key:"getOriginImageHeight",value:function(){return this.origin_image_height}}]),e}(b.default);e.default=y},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),l=(i(s),n(3)),d=i(l),c=n(2),h=i(c),m=function(t){function e(t){a(this,e);var n=o(this,Object.getPrototypeOf(e).call(this));n.init_step_method=[{method:"",method_id:d.default.createMethodId()}];var i=[];return n.step_method=n.init_step_method.concat(i),n.setEmitter(t.emitter),n}return r(e,t),u(e,[{key:"getStepMethod",value:function(){return this.step_method||[]}},{key:"pushStepMethod",value:function(t){void 0!==t&&(t.method_id=t.method_id||d.default.createMethodId(),this.step_method.push(t),console.log("this.step_method :: ",this.step_method),this.getEmitter().emit("step.method.option.added",t))}},{key:"spliceStepMethod",value:function(t){if(void 0!==t&&"string"==typeof t.method_id&&""!==t.method_id){for(var e=void 0,n=0;n<this.step_method.length;n++)if(this.step_method[n].method_id===t.method_id){e=n;break}e>=0&&(this.step_method.splice(e,1),this.getEmitter().emit("step.method.option.deleted",t))}}}]),e}(h.default);e.default=m}]);