!function(t){function e(a){if(n[a])return n[a].exports;var i=n[a]={exports:{},id:a,loaded:!1};return t[a].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(2)},function(t,e){"use strict";function n(t){return t?a(t):void 0}function a(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},n.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var a,i=0;i<n.length;i++)if(a=n[i],a===e||a.fn===e){n.splice(i,1);break}return this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks["$"+t];if(n){n=n.slice(0);for(var a=0,i=n.length;i>a;++a)n[a].apply(this,e)}return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,n){"use strict";n(3)},function(t,e,n){"use strict";!function(){var t=n(4),e=document.querySelectorAll('[data-majo="picture-filter"]');new t(e[0],{}),new t(e[1],{width:250,height:100})}()},function(t,e,n){"use strict";function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){e=e||{};var s=n(1),h=function(){function t(){o(this,t)}return r(t,null,[{key:"createMethodId",value:function(){return Date.now()+"-"+Math.floor(100*Math.random())}}]),t}(),d=function M(){o(this,M)};d.METHOD_SNOW="SNOW",d.METHOD_SNOW_NAME="雪花",d.METHOD_DOT="DOT",d.METHOD_DOT_NAME="黑點",d.METHOD_ALPHA="ALPHA",d.METHOD_ALPHA_NAME="透明",d.METHOD_GRAY="GRAY",d.METHOD_GRAY_NAME="灰階",d.METHOD_BRIGHTNESS="BRIGHTNESS",d.METHOD_BRIGHTNESS_NAME="亮度",d.METHOD_CONTRAST="CONTRAST",d.METHOD_CONTRAST_NAME="對比",d.METHOD_SATURATE="SATURATE",d.METHOD_SATURATE_NAME="彩度",d.METHOD_HUE_ROTATE="HUE_ROTATE",d.METHOD_HUE_ROTATE_NAME="色相轉換",d.METHOD_INVERT="INVERT",d.METHOD_INVERT_NAME="負片",d.METHOD_SEPIA="SEPIA",d.METHOD_SEPIA_NAME="復古";var u=function(){function t(e,n){o(this,t),this.WEAK_MAP=new WeakMap,this.initConst=function(t){var e={};return this.WEAK_MAP.set(t,e),e},this.getConst=function(t){return this.WEAK_MAP.get(t)},this.addConst=function(t,e,n){var a=this.WEAK_MAP||{};return a[e]=n,this.WEAK_MAP.set(t,a),a},this.defaultAction(e,n)}return r(t,[{key:"setImageInitData",value:function(t){this.image_init_data=t,v.emit("initData.changed",{origin_data:t})}},{key:"getMainSection",value:function(){return this.getConst(this).MAIN_SECTION}},{key:"getObjImagePreview",value:function(){return this.getConst(this).OBJ_IMAGE_PREVIEW}},{key:"getObjMethodSelect",value:function(){return this.getConst(this).OBJ_METHOD_SELECT}},{key:"getObjMethodResult",value:function(){return this.getConst(this).OBJ_METHOD_RESULT}},{key:"getObjCanvasPreview",value:function(){return this.getConst(this).OBJ_CANVAS_PREVIEW}},{key:"getObjCanvasPreview2d",value:function(){return this.getConst(this).OBJ_CANVAS_PREVIEW_2D}},{key:"getPreviewSize",value:function(){return this.getConst(this).PREVIEW_SIZE}},{key:"getObjUpload",value:function(){return this.getConst(this).OBJ_UPLOAD}},{key:"returnUploadSection",value:function(){var t=document.createElement("div"),e=document.createElement("input");return e.type="file",this.uploadAction.call(e,this),this.addConst(this,"OBJ_UPLOAD",e),t.appendChild(e),t}},{key:"returnCanvasSection",value:function(){var t=document.createElement("div"),e=this.getPreviewSize(),n=document.createElement("canvas");n.setAttribute("data-obj","preview"),n.width=e.width,n.height=e.height,this.addConst(this,"OBJ_CANVAS_PREVIEW",n),t.appendChild(n);var a=n.getContext("2d");return this.addConst(this,"OBJ_CANVAS_PREVIEW_2D",a),t}},{key:"returnMethodSection",value:function(){var t=document.createElement("div"),e=document.createElement("span");t.appendChild(e);var n=document.createElement("select");n.name="method";var a="";a+='<option value="">---請選擇---</option>',a+='<option value="'+d.METHOD_SNOW+'">'+d.METHOD_SNOW_NAME+"</option>",a+='<option value="'+d.METHOD_ALPHA+'">'+d.METHOD_ALPHA_NAME+"</option>",a+='<option value="'+d.METHOD_DOT+'">'+d.METHOD_DOT_NAME+"</option>",a+='<option value="'+d.METHOD_GRAY+'">'+d.METHOD_GRAY_NAME+"</option>",a+='<option value="'+d.METHOD_CONTRAST+'">'+d.METHOD_CONTRAST_NAME+"</option>",n.insertAdjacentHTML("afterbegin",a);var i=document.createElement("button");return i.innerText="新增效果",this.methodAddBtnAction.call(i,this),t.appendChild(n),t.appendChild(i),this.addConst(this,"OBJ_METHOD_SECTION",t),this.addConst(this,"OBJ_METHOD_RESULT",e),this.addConst(this,"OBJ_METHOD_SELECT",n),t}},{key:"makeTempate",value:function(){var t=this.getMainSection();if(void 0!==t){var e=this.returnUploadSection(),n=this.returnCanvasSection(),a=this.returnMethodSection();t.appendChild(e),t.appendChild(a),t.appendChild(n)}}},{key:"defaultAction",value:function(t,e){var n=this;if(n.initConst(this),e=e||{},e.width=e.width>0?e.width:600,e.height=e.height>0?e.height:450,t.nodeType>=1){var a=new Image;a.onload=function(t){var e=n.getObjCanvasPreview(),a=n.getObjCanvasPreview2d();a.clearRect(0,0,e.width,e.height),a.drawImage(this,0,0,e.width,e.height)},n.imagePreviewOnLoad.call(a,this),n.addConst(this,"MAIN_SECTION",t),n.addConst(this,"PREVIEW_SIZE",e),n.addConst(this,"OBJ_IMAGE_PREVIEW",a),n.makeTempate()}}},{key:"imagePreviewOnLoad",value:function(t){var e=this;e.onload=function(e){var n=t.getObjCanvasPreview(),a=t.getObjCanvasPreview2d();a.clearRect(0,0,n.width,n.height),a.drawImage(this,0,0,n.width,n.height)}}},{key:"uploadAction",value:function(t){var e=this;e.onchange=function(e){var n=window.URL||window.webkitURL,a=n.createObjectURL(this.files[0]);t.setImageInitData(a)}}},{key:"methodAddBtnAction",value:function(t){var e=this;e.onclick=function(e){var n=t.getObjMethodSelect().value;""!==n?v.emit("step.method.pushing",{method:n}):console.log("不應為空!!")}}},{key:"methodDeleteBtnAction",value:function(t){var e=this;e.onclick=function(t){v.emit("step.method.splicing",{method:e.data.method,method_id:e.data.method_id,method_btn:this})}}}]),t}(),c=function(){function t(){o(this,t)}return r(t,[{key:"setComputeWidth",value:function(t){this.compute_width=t||0}},{key:"setComputeHeight",value:function(t){this.compute_height=t||0}},{key:"getComputeWidth",value:function(){return this.compute_width}},{key:"getComputeHeight",value:function(){return this.compute_height}}]),t}(),l=function(t){function e(){o(this,e);var t=a(this,Object.getPrototypeOf(e).call(this)),n=t;return n.obj_canvas=document.createElement("canvas"),n.obj_canvas_2d=n.obj_canvas.getContext("2d"),n.obj_image=new Image,v.on("imageData.step.success.loaded",function(t){var e=arguments[0],a=e.method;console.log("METHOD :: ",a),a===d.METHOD_SNOW?n.methodSnow(e):a===d.METHOD_DOT?n.methodDot(e):a===d.METHOD_ALPHA?n.methodAlpha(e):a===d.METHOD_GRAY?n.methodGray(e):a===d.METHOD_CONTRAST?n.methodContrast(e):n.methodOrigin(e)}),n.obj_image.onload=function(){if("string"==typeof this.src&&""!==this.src){var t=this.width,e=this.height;n.obj_canvas.width=t,n.obj_canvas.height=e,n.obj_canvas_2d.drawImage(this,0,0,t,e),n.setComputeWidth(t),n.setComputeHeight(e),v.emit("imageData.step.success.loaded",{origin_data:this.src,method:n.getPainterMethod()})}else console.log("***")},n.obj_image.error=function(){v.emit("imageData.step.error.loaded",{origin_data:this.src})},t}return i(e,t),r(e,[{key:"getPainterMethod",value:function(){var t=this;return t.painter_method}},{key:"changeData",value:function(t,e){var n=this;n.painter_method=t,n.obj_image.src=e}},{key:"methodOrigin",value:function(t){var e=this;e.emitAfterMethod(t)}},{key:"methodSnow",value:function(t){for(var e=this,n=e.getComputeWidth(),a=e.getComputeHeight(),i=void 0,o=void 0,s=0;500>=s;s++)i=Math.floor(Math.random()*n),o=Math.floor(Math.random()*a),e.obj_canvas_2d.fillStyle="white",e.obj_canvas_2d.beginPath(),e.obj_canvas_2d.arc(i,o,3,0,2*Math.PI,!0),e.obj_canvas_2d.closePath(),e.obj_canvas_2d.fill();e.emitAfterMethod(t)}},{key:"methodDot",value:function(t){for(var e=this,n=e.getComputeWidth(),a=e.getComputeHeight(),i=void 0,o=void 0,s=0;150>=s;s++)i=Math.floor(Math.random()*n),o=Math.floor(Math.random()*a),e.obj_canvas_2d.fillStyle="black",e.obj_canvas_2d.beginPath(),e.obj_canvas_2d.arc(i,o,5,0,2*Math.PI,!0),e.obj_canvas_2d.closePath(),e.obj_canvas_2d.fill();e.emitAfterMethod(t)}},{key:"methodAlpha",value:function(t){for(var e=this,n=e.getComputeWidth(),a=e.getComputeHeight(),i=e.obj_canvas_2d.getImageData(0,0,n,a),o=0;n*a*4>o;o+=4)i.data[o+3]=.5*i.data[o+3];e.obj_canvas_2d.putImageData(i,0,0),e.emitAfterMethod(t)}},{key:"methodGray",value:function(t){for(var e=this,n=e.getComputeWidth(),a=e.getComputeHeight(),i=e.obj_canvas_2d.getImageData(0,0,n,a),o=void 0,s=void 0,r=void 0,h=void 0,d=0;n*a*4>d;d+=4)o=i.data[d],s=i.data[d+1],r=i.data[d+2],h=parseInt((o+s+r)/3),i.data[d]=h,i.data[d+1]=h,i.data[d+2]=h;e.obj_canvas_2d.putImageData(i,0,0),e.emitAfterMethod(t)}},{key:"methodContrast",value:function(t){for(var e=this,n=e.getComputeWidth(),a=e.getComputeHeight(),i=e.obj_canvas_2d.getImageData(0,0,n,a),o=-50,s=259*(o+255)/(255*(259-o)),r=0;r<i.data.length;r+=4)i.data[r]=s*(i.data[r]-128)+128,i.data[r+1]=s*(i.data[r+1]-128)+128,i.data[r+2]=s*(i.data[r+2]-128)+128;e.obj_canvas_2d.putImageData(i,0,0),e.emitAfterMethod(t)}},{key:"emitAfterMethod",value:function(t){t=t||{};var e=this,n=e.obj_canvas.toDataURL(),a={origin_data:t.origin_data,data:n};void 0!==t.method_id&&(a.method_id=t.method_id),v.emit("imageData.step.success.computed",a)}}]),e}(c),p=function(){function t(){o(this,t);var e=this;this.step_data=[],v.on("initData.changed",function(t){e.step_data=[];var n=arguments[0];E.changeData("",n.origin_data)}),v.on("imageData.step.success.computed",function(t){var n=arguments[0];n&&"string"==typeof n.origin_data&&""!==n.origin_data&&e.pushStepData(n)})}return r(t,[{key:"getStepData",value:function(){return this.step_data||[]}},{key:"setStepData",value:function(t){var e=this;t=t||[];var n=JSON.parse(JSON.stringify(t));this.step_data=n,setTimeout(function(){e.runningData()},1)}},{key:"pushStepData",value:function(t){var e=this;if(void 0===t.method_id){var n=JSON.parse(JSON.stringify(e.getStepData())),a=n.length,i=JSON.parse(JSON.stringify(g.getStepMethod())),o=i.length;if(o>=a){var s=i[a].method_id;t.method_id=s}}e.step_data.push(t),setTimeout(function(){e.runningData()},1)}},{key:"runningData",value:function(){var t=this,e=t.step_data.length,n=g.getStepMethod(),a=t.getStepData(),i=a[a.length-1];e<n.length?E.changeData(n[e].method,i.data):(v.emit("imageData.final.step.computed",i),console.log("******************* 預覽圖片!! *******************"))}}]),t}(),_=function(){function t(){o(this,t),this.init_step_method=[{method:"",method_id:h.createMethodId()}];var e=[];this.step_method=this.init_step_method.concat(e)}return r(t,[{key:"getStepMethod",value:function(){return this.step_method||[]}},{key:"getConstNameByEn",value:function(t){return"string"==typeof t&&""!==t?d["METHOD_"+t+"_NAME"]:void 0}},{key:"pushStepMethod",value:function(t){void 0!==t&&(t.method_id=t.method_id||h.createMethodId(),this.step_method.push(t),v.emit("step.method.option.added",t))}},{key:"spliceStepMethod",value:function(t){if(void 0!==t&&"string"==typeof t.method_id&&""!==t.method_id){for(var e=void 0,n=0;n<this.step_method.length;n++)if(this.step_method[n].method_id===t.method_id){e=n;break}e>=0&&(this.step_method.splice(e,1),v.emit("step.method.option.deleted",t))}}}]),t}(),m=new u(t,e),g=new _,v=new s,f=new p,E=new l;void 0!==t&&(v.on("imageData.final.step.computed",function(t){var e=arguments[0];m.getObjImagePreview().src=e.data}),v.on("stepMethod.show.adding",function(t){var e=arguments[0],n=document.createElement("span");n.style.marginRight="20px",n.data=n.data||{},n.data.method_id=e.method_id,n.data.method=e.method,n.setAttribute("data-method-id",e.method_id),n.insertAdjacentHTML("beforeend",g.getConstNameByEn(e.method)),m.getObjMethodResult().appendChild(n),m.methodDeleteBtnAction.call(n,m);var a=f.getStepData();if(a instanceof Array==!0&&a.length>0){E.getComputeWidth(),E.getComputeHeight();v.emit("imageData.step.success.loaded",{origin_data:a[a.length-1].data,method:e.method})}}),v.on("stepMethod.show.deleting",function(t){var e=arguments[0],n=f.getStepData();if(n instanceof Array==!0&&n.length>0){for(var a=n.length,i=[],o=0;a>o&&n[o].method_id!==e.method_id;o++)i.push(n[o]);var s=i.length;s<n.length&&f.setStepData(i)}m.getObjMethodResult().removeChild(e.method_btn)}),v.on("step.method.pushing",function(){g.pushStepMethod.apply(g,arguments)}),v.on("step.method.splicing",function(){g.spliceStepMethod.apply(g,arguments)}),v.on("step.method.option.added",function(t){var e=arguments[0];v.emit("stepMethod.show.adding",e)}),v.on("step.method.option.deleted",function(t){var e=arguments[0];v.emit("stepMethod.show.deleting",e)}))}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}();t.exports=s}]);