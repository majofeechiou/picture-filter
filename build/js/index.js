!function(t){function e(n){if(a[n])return a[n].exports;var i=a[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e,a){t.exports=a(2)},function(t,e){"use strict";function a(t){return t?n(t):void 0}function n(t){for(var e in a.prototype)t[e]=a.prototype[e];return t}t.exports=a,a.prototype.on=a.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},a.prototype.once=function(t,e){function a(){this.off(t,a),e.apply(this,arguments)}return a.fn=e,this.on(t,a),this},a.prototype.off=a.prototype.removeListener=a.prototype.removeAllListeners=a.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var a=this._callbacks["$"+t];if(!a)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var n,i=0;i<a.length;i++)if(n=a[i],n===e||n.fn===e){a.splice(i,1);break}return this},a.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),a=this._callbacks["$"+t];if(a){a=a.slice(0);for(var n=0,i=a.length;i>n;++n)a[n].apply(this,e)}return this},a.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},a.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,a){"use strict";a(3)},function(t,e,a){"use strict";function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}();!function(t){var e=a(1),r=function(){function e(t,a){o(this,e),this.WEAK_MAP=new WeakMap,this.initConst=function(t){var e={};return this.WEAK_MAP.set(t,e),e},this.getConst=function(t){return this.WEAK_MAP.get(t)},this.addConst=function(t,e,a){var n=this.WEAK_MAP||{};return n[e]=a,this.WEAK_MAP.set(t,n),n},this.defaultAction(t,a)}return s(e,[{key:"setImageInitData",value:function(t){this.image_init_data=t,p.emit("initData.changed",{origin_data:t})}},{key:"getMainSection",value:function(){return this.getConst(this).MAIN_SECTION}},{key:"getObjImagePreview",value:function(){return this.getConst(this).OBJ_IMAGE_PREVIEW}},{key:"getObjMethodSelect",value:function(){return this.getConst(this).OBJ_METHOD_SELECT}},{key:"getObjMethodResult",value:function(){return this.getConst(this).OBJ_METHOD_RESULT}},{key:"getObjCanvasPreview",value:function(){return this.getConst(this).OBJ_CANVAS_PREVIEW}},{key:"getObjCanvasPreview2d",value:function(){return this.getConst(this).OBJ_CANVAS_PREVIEW_2D}},{key:"getPreviewSize",value:function(){return this.getConst(this).PREVIEW_SIZE}},{key:"getObjUpload",value:function(){return this.getConst(this).OBJ_UPLOAD}},{key:"returnUploadSection",value:function(){var t=document.createElement("div"),e=document.createElement("input");return e.type="file",this.uploadAction.call(e,this),this.addConst(this,"OBJ_UPLOAD",e),t.appendChild(e),t}},{key:"returnCanvasSection",value:function(){var t=document.createElement("div"),e=this.getPreviewSize(),a=document.createElement("canvas");a.setAttribute("data-obj","preview"),a.width=e.width,a.height=e.height,this.addConst(this,"OBJ_CANVAS_PREVIEW",a),t.appendChild(a);var n=a.getContext("2d");return this.addConst(this,"OBJ_CANVAS_PREVIEW_2D",n),t}},{key:"returnMethodSection",value:function(){var t=document.createElement("div"),e=document.createElement("span");t.appendChild(e);var a=document.createElement("select");a.name="method";var n="";n+='<option value="">---請選擇---</option>',n+='<option value="'+l.METHOD_SNOW+'">'+l.METHOD_SNOW_NAME+"</option>",n+='<option value="'+l.METHOD_ALPHA+'">'+l.METHOD_ALPHA_NAME+"</option>",n+='<option value="'+l.METHOD_DOT+'">'+l.METHOD_DOT_NAME+"</option>",n+='<option value="'+l.METHOD_GRAY+'">'+l.METHOD_GRAY_NAME+"</option>",n+='<option value="'+l.METHOD_CONTRAST+'">'+l.METHOD_CONTRAST_NAME+"</option>",a.insertAdjacentHTML("afterbegin",n);var i=document.createElement("button");return i.innerText="新增效果",this.methodAddBtnAction.call(i,this),t.appendChild(a),t.appendChild(i),this.addConst(this,"OBJ_METHOD_SECTION",t),this.addConst(this,"OBJ_METHOD_RESULT",e),this.addConst(this,"OBJ_METHOD_SELECT",a),t}},{key:"makeTempate",value:function(){var t=this,e=this.getMainSection();if(void 0!==e){var a=this.returnUploadSection(),n=this.returnCanvasSection(),i=this.returnMethodSection();p.on("imageData.final.step.computed",function(e){var a=arguments[0];t.getObjImagePreview().src=a.data}),p.on("stepMethod.show.adding",function(e){var a=arguments[0];t.getObjMethodResult().insertAdjacentHTML("beforeend",l.getConstNameByEn(a.method));var n=_.getStepData();if(n instanceof Array==!0&&n.length>0){g.getComputeWidth(),g.getComputeHeight();p.emit("imageData.step.success.loaded",{origin_data:n[n.length-1].data,painter_method:a.method})}}),p.on("stepMethod.option.added",function(t){var e=arguments[0];p.emit("stepMethod.show.adding",e)}),e.appendChild(a),e.appendChild(i),e.appendChild(n)}}},{key:"defaultAction",value:function(t,e){var a=this;if(a.initConst(this),e=e||{},e.width=e.width>0?e.width:600,e.height=e.height>0?e.height:450,t.nodeType>=1){var n=new Image;n.onload=function(t){var e=a.getObjCanvasPreview(),n=a.getObjCanvasPreview2d();n.clearRect(0,0,e.width,e.height),n.drawImage(this,0,0,e.width,e.height)},a.imagePreviewOnLoad.call(n,this),a.addConst(this,"MAIN_SECTION",t),a.addConst(this,"PREVIEW_SIZE",e),a.addConst(this,"OBJ_IMAGE_PREVIEW",n),a.makeTempate()}}},{key:"imagePreviewOnLoad",value:function(t){var e=this;e.onload=function(e){var a=t.getObjCanvasPreview(),n=t.getObjCanvasPreview2d();n.clearRect(0,0,a.width,a.height),n.drawImage(this,0,0,a.width,a.height)}}},{key:"uploadAction",value:function(e){var a=this;a.onchange=function(a){var n=t.URL||t.webkitURL,i=n.createObjectURL(this.files[0]);e.setImageInitData(i)}}},{key:"methodAddBtnAction",value:function(t){var e=this;e.onclick=function(e){var a=t.getObjMethodSelect().value;console.log("_str_method_value :: ",a),""!==a?l.pushStepMethod({method:a}):console.log("不應為空!!")}}}]),e}(),h=function(){function t(){o(this,t)}return s(t,[{key:"setComputeWidth",value:function(t){this.compute_width=t||0}},{key:"setComputeHeight",value:function(t){this.compute_height=t||0}},{key:"getComputeWidth",value:function(){return this.compute_width}},{key:"getComputeHeight",value:function(){return this.compute_height}}]),t}(),c=function(t){function e(){o(this,e);var t=n(this,Object.getPrototypeOf(e).call(this)),a=t;return a.obj_canvas=document.createElement("canvas"),a.obj_canvas_2d=a.obj_canvas.getContext("2d"),a.obj_image=new Image,p.on("imageData.step.success.loaded",function(t){var e=arguments[0],n=e.painter_method;console.log("METHOD :: ",n),n===l.METHOD_SNOW?a.methodSnow(e):n===l.METHOD_DOT?a.methodDot(e):n===l.METHOD_ALPHA?a.methodAlpha(e):n===l.METHOD_GRAY?a.methodGray(e):n===l.METHOD_CONTRAST?a.methodContrast(e):a.methodOrigin(e)}),a.obj_image.onload=function(){if("string"==typeof this.src&&""!==this.src){var t=this.width,e=this.height;a.obj_canvas.width=t,a.obj_canvas.height=e,a.obj_canvas_2d.drawImage(this,0,0,t,e),a.setComputeWidth(t),a.setComputeHeight(e),p.emit("imageData.step.success.loaded",{origin_data:this.src,painter_method:a.getPainterMethod()})}else console.log("***")},a.obj_image.error=function(){p.emit("imageData.step.error.loaded",{origin_data:this.src})},t}return i(e,t),s(e,[{key:"getPainterMethod",value:function(){var t=this;return t.painter_method}},{key:"changeData",value:function(t,e){var a=this;a.painter_method=t,a.obj_image.src=e}},{key:"methodOrigin",value:function(t){var e=this,a=e.obj_canvas.toDataURL();p.emit("imageData.step.success.computed",{origin_data:t.origin_data,data:a})}},{key:"methodSnow",value:function(t){for(var e=this,a=e.getComputeWidth(),n=e.getComputeHeight(),i=void 0,o=void 0,s=0;500>=s;s++)i=Math.floor(Math.random()*a),o=Math.floor(Math.random()*n),e.obj_canvas_2d.fillStyle="white",e.obj_canvas_2d.beginPath(),e.obj_canvas_2d.arc(i,o,3,0,2*Math.PI,!0),e.obj_canvas_2d.closePath(),e.obj_canvas_2d.fill();e.emitAfterMethod(t)}},{key:"methodDot",value:function(t){for(var e=this,a=e.getComputeWidth(),n=e.getComputeHeight(),i=void 0,o=void 0,s=0;150>=s;s++)i=Math.floor(Math.random()*a),o=Math.floor(Math.random()*n),e.obj_canvas_2d.fillStyle="black",e.obj_canvas_2d.beginPath(),e.obj_canvas_2d.arc(i,o,5,0,2*Math.PI,!0),e.obj_canvas_2d.closePath(),e.obj_canvas_2d.fill();e.emitAfterMethod(t)}},{key:"methodAlpha",value:function(t){for(var e=this,a=e.getComputeWidth(),n=e.getComputeHeight(),i=e.obj_canvas_2d.getImageData(0,0,a,n),o=0;a*n*4>o;o+=4)i.data[o+3]=128;e.obj_canvas_2d.putImageData(i,0,0),e.emitAfterMethod(t)}},{key:"methodGray",value:function(t){for(var e=this,a=e.getComputeWidth(),n=e.getComputeHeight(),i=e.obj_canvas_2d.getImageData(0,0,a,n),o=void 0,s=void 0,r=void 0,h=void 0,c=0;a*n*4>c;c+=4)o=i.data[c],s=i.data[c+1],r=i.data[c+2],h=parseInt((o+s+r)/3),i.data[c]=h,i.data[c+1]=h,i.data[c+2]=h;e.obj_canvas_2d.putImageData(i,0,0),e.emitAfterMethod(t)}},{key:"methodContrast",value:function(t){for(var e=this,a=e.getComputeWidth(),n=e.getComputeHeight(),i=e.obj_canvas_2d.getImageData(0,0,a,n),o=-50,s=259*(o+255)/(255*(259-o)),r=0;r<i.data.length;r+=4)i.data[r]=s*(i.data[r]-128)+128,i.data[r+1]=s*(i.data[r+1]-128)+128,i.data[r+2]=s*(i.data[r+2]-128)+128;e.obj_canvas_2d.putImageData(i,0,0),e.emitAfterMethod(t)}},{key:"emitAfterMethod",value:function(t){var e=this,a=e.obj_canvas.toDataURL();p.emit("imageData.step.success.computed",{origin_data:t.origin_data,data:a})}}]),e}(h),u=function(){function t(){o(this,t);var e=this;this.step_data=[],p.on("initData.changed",function(t){e.step_data=[];var a=arguments[0];g.changeData("",a.origin_data)}),p.on("imageData.step.success.computed",function(t){var a=arguments[0];if(a&&"string"==typeof a.origin_data&&""!==a.origin_data){e.step_data.push(a);var n=e.step_data.length,i=l.getStepMethod();n<i.length?g.changeData(i[n].method,a.data):p.emit("imageData.final.step.computed",a)}}),p.emit("imageData.step.success.computed")}return s(t,[{key:"getStepData",value:function(){return this.step_data||[]}}]),t}(),d=function(){function t(){o(this,t),this.METHOD_SNOW="SNOW",this.METHOD_ALPHA="ALPHA",this.METHOD_DOT="DOT",this.METHOD_GRAY="GRAY",this.METHOD_CONTRAST="CONTRAST",this.METHOD_SNOW_NAME="雪花",this.METHOD_ALPHA_NAME="透明",this.METHOD_DOT_NAME="黑點",this.METHOD_GRAY_NAME="灰階",this.METHOD_CONTRAST_NAME="對比",this.init_step_method=[{method:""}];var e=[];this.step_method=this.init_step_method.concat(e)}return s(t,[{key:"getStepMethod",value:function(){return this.step_method||[]}},{key:"getConstNameByEn",value:function(t){return"string"==typeof t&&""!==t?this["METHOD_"+t+"_NAME"]:void 0}},{key:"pushStepMethod",value:function(t){void 0!==t&&(this.step_method.push(t),p.emit("stepMethod.option.added",t))}}]),t}();t.mainImageGilter=r;var l=new d,p=new e,_=new u,g=new c,v=document.querySelectorAll('[data-majo="picture-filter"]');new r(v[0])}(window)}]);