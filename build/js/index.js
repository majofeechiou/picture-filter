!function(t){function e(i){if(n[i])return n[i].exports;var a=n[i]={exports:{},id:i,loaded:!1};return t[i].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){"use strict";n(2)},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();!function(t){var e=function(){function t(){n(this,t)}return i(t,[{key:"snow",value:function(t){var e=document.createElement("canvas"),n=e.getContext("2d"),i=t.width,a=t.height;e.width=i,e.height=a,n.drawImage(t,0,0,i,a),c.drawImageCover(n,t,0,0,i,a);for(var o=0;500>=o;o++){var r=Math.floor(Math.random()*i),s=Math.floor(Math.random()*a);n.fillStyle="white",n.beginPath(),n.arc(r,s,3,0,2*Math.PI,!0),n.closePath(),n.fill()}var u=e.toDataURL();return u}}]),t}(),a=function(){function t(){n(this,t)}return i(t,[{key:"drawImageCover",value:function(t,e,n,i,a,o,r,s){2===arguments.length&&(n=i=0,a=t.canvas.width,o=t.canvas.height),r="number"==typeof r?r:.5,s="number"==typeof s?s:.5,0>r&&(r=0),0>s&&(s=0),r>1&&(r=1),s>1&&(s=1);var u=e.width,c=e.height,h=Math.min(a/u,o/c),d=u*h,g=c*h,v=void 0,l=void 0,f=void 0,m=void 0,p=1;a>d&&(p=a/d),o>g&&(p=o/g),d*=p,g*=p,f=u/(d/a),m=c/(g/o),v=(u-f)*r,l=(c-m)*s,0>v&&(v=0),0>l&&(l=0),f>u&&(f=u),m>c&&(m=c),t.drawImage(e,v,l,f,m,n,i,a,o)}}]),t}(),o=function(){function e(t,i){n(this,e),this.defindEvent=new s,this.WEAK_MAP=new WeakMap,this.initConst=function(t){var e={};return this.WEAK_MAP.set(t,e),e},this.getConst=function(t){return this.WEAK_MAP.get(t)},this.addConst=function(t,e,n){var i=this.WEAK_MAP||{};return i[e]=n,this.WEAK_MAP.set(t,i),i},this.defaultAction(t,i)}return i(e,[{key:"setImageOriginData",value:function(t){this.image_origin_data=t}},{key:"getMainSection",value:function(){return this.getConst(this).MAIN_SECTION}},{key:"getObjCanvasPreview",value:function(){return this.getConst(this).OBJ_CANVAS_PREVIEW}},{key:"getPreviewSize",value:function(){return this.getConst(this).PREVIEW_SIZE}},{key:"getObjUpload",value:function(){return this.getConst(this).OBJ_UPLOAD}},{key:"makeTempate",value:function(){var t=document.createElement("input");t.type="file";var e=this.getPreviewSize(),n=document.createElement("canvas");n.setAttribute("data-obj","preview"),n.width=e.width,n.height=e.height;var i=this.getMainSection();void 0!==i&&(this.addConst(this,"OBJ_UPLOAD",t),this.addConst(this,"OBJ_CANVAS",n),i.appendChild(t),i.appendChild(n),this.addConst(this,"OBJ_CANVAS_PREVIEW",i.querySelectorAll('[data-obj="preview"]')[0]))}},{key:"defaultAction",value:function(t,e){this.initConst(this),e=e||{},e.width=e.width>0?e.width:600,e.height=e.height>0?e.height:450,t.nodeType>=1&&(this.addConst(this,"MAIN_SECTION",t),this.addConst(this,"PREVIEW_SIZE",e),this.makeTempate())}},{key:"paintStep",value:function(t,e,n){t=t||{};var i=this;void 0===i.imageProcess&&delete i.imageProcess,i.imageProcess=new r(t.data,e).then(function(t){delete this,n&&n instanceof Function==!0&&n(t)})}},{key:"painterRun",value:function(t,e){t=t||{};var n=this,i=t.step||0;new r(t.data,e).then(function(a){delete this,a.success===!0&&(n.defindEvent.createListen("image.data.changed."+i,{step:i,origin_data:t.data,data:a.data}),n.getMainSection().removeEventListener("image.data.changed."+i),n.getMainSection().addEventListener("image.data.changed."+i,function(t){console.log("------",i),3>i?n.paintStep(t.detail,e,function(){var i=t.detail||{};i.step=i.step+1,console.trace(),n.painterRun(i,e)},!1):3===i&&(console.log("end"),n.paintInCanvas(t.detail))}))}).then(function(){3>=i&&n.defindEvent.dispatchEvent("image.data.changed."+i,n.getMainSection())})}},{key:"paintInCanvas",value:function(t){t=t||{};var e=this,n=e.getObjCanvasPreview(),i=n.getContext("2d");void 0===e._obj_img&&(console.log("new Image()"),e._obj_img=new Image,e._obj_img.onload=function(){c.drawImageCover(i,e._obj_img,0,0,e.getPreviewSize().width,e.getPreviewSize().height)}),e._obj_img.src=t.data}},{key:"create",value:function(){var e=this;this.getObjUpload().onchange=function(n){var i=t.URL||t.webkitURL,a=i.createObjectURL(this.files[0]);e.setImageOriginData(a);var o=u.snow,r={step:0,data:a};e.painterRun(r,o)}}}]),e}(),r=function(){function t(e,i,a){n(this,t);var o=this.getData(e,i);return a?void o.then(a):o}return i(t,[{key:"getData",value:function(t,e){var n=this;return void 0!==n.promise&&delete n.promise,n.promise=new Promise(function(i,a){void 0===n.obj_image&&(n.obj_image=new Image,n.obj_image.onload=function(){var t=e(this);i({success:!0,data:t})},n.obj_image.onerror=function(){a({success:!0,error_message:"產生錯誤，未成功得到資料"})},n.obj_image.crossOrigin=null),n.obj_image.src=t}),n.promise}}]),t}(),s=function(){function t(){n(this,t),this.triggers={}}return i(t,[{key:"createListen",value:function(t,e){void 0!==this.triggers[t]&&(this.triggers[t]=null,delete this.triggers[t]),this.triggers[t]=new CustomEvent(t,{detail:e})}},{key:"dispatchEvent",value:function(t,e){e.dispatchEvent(this.triggers[t])}}]),t}(),u=new e,c=new a;t.Pfilter=o;var h=document.querySelectorAll('[data-majo="picture-filter"]'),d=new o(h[0]),g=new o(h[1],{width:450,height:100});setTimeout(function(){d.create(),g.create()},0)}(window)}]);